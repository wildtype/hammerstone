Memulai Test Driven Development dengan Javascript dan Jasmine Spec
15 Oktober 2016, 14:45
tdd-jasmine
---
Dibimbing test
---
<h3>Pengantar</h3>
<p>Sebenarnya sudah lama ingin menulis tentang Jasmine Spec. Rasanya tidak tepat jika tiba-tiba membahas berbagai hal tentang Jasmine Spec tanpa pernah memperkenalkan TDD, mengingat belum banyak literatur TDD dalam Bahasa Indonesia, tetapi saya sendiri kebingungan bagaimana memperkenalkannya secara mudah. Kemudian saya menonton video <a href="https://www.youtube.com/watch?v=EQ4sN8fgXKY">[LD] Code Kata - FizzBuzz | Let's Develop</a>. Video tersebut memperkenalkan TDD dengan baik, sebagian tulisan ini merupakan adaptasi yang diimplementasikan dengan Javascript dan Jasmine Spec.</p>
<p>Dalam Test Driven Development, software dikembangkan dengan iterasi pendek dimana programmer menerjemahkan spesifikasi software menjadi test yang sederhana, dilanjutkan dengan penulisan kode sesederhana mungkin untuk meluluskan test tersebut. Kode yang telah lulus test kemudian diperbaiki serapi mungkin. Siklus diulang sampai software memenuhi seluruh spesifikasi yang diminta. Proses ini sering disebut "Red, Green, Refactor" yang menjadi motto TDD.</p>
<p>Jasmine Spec adalah test framework untuk javascript yang bergaya behavior-driven, mirip dengan RSpec di bahasa ruby. Perbedaan dengan testing framework biasa adalah test ditulis dengan tata bahasa yang mirip dengan spesifikasi. Spesifikasi/spec menjelaskan kondisi-kondisi yang sedang diuji dan ekspektasi yang dihasilkan oleh unit ketika dijalankan.</p>
<p>Versi terbaru Jasmine Spec dapat didownload dari halaman rilisnya di Github: <a href="https://github.com/jasmine/jasmine/releases/">https://github.com/jasmine/jasmine/releases/</a>. Dalam tulisan ini kita hanya cukup menggunakan distribusi <a href="https://github.com/jasmine/jasmine/releases/download/v2.5.2/jasmine-standalone-2.5.2.zip">jasmine-standalone</a>. Di dalam paket tersebut terdapat folder <code>lib</code> yang berisi kode sumber jasmine dan tidak akan kita sentuh, <code>src</code> yang akan menjadi tempat meletakkan kode sumber software kita, <code>spec</code> yang akan kita isi dengan kode sumber test, dan <code>SpecRunner.html</code> yang akan menjalankan test kita di browser.</p>
<h3>Test Driven FizzBuzz</h3>
<p>Disini kita akan menyelesaikan contoh pemrograman klasik <code>fizzBuzz</code> dalam javascript, dituntun oleh test. Spesifikasi fungsi <code>fizzBuzz</code> yang akan kita buat adalah sebagai berikut:</p>
<ol>
<li>Fungsi fizzBuzz menerima parameter angka bulat <code>n</code></li>
<li>Jika <code>n</code> habis dibagi 3, maka fungsi fizzBuzz bernilai "Fizz"</li>
<li>Jika <code>n</code> habis dibagi 5, maka fungsi fizzBuzz bernilai "Buzz"</li>
<li>Jika <code>n</code> habis dibagi 3 dan 5, maka fungsi fizzBuzz bernilai "FizzBuzz"</li>
<li>Selain itu maka fungsi fizzBuzz bernilai string angka <code>n</code></li>
</ol>
<p>Untuk memulai, kita perlu mengubah isi file <code>SpecRunner.html</code> menjadi seperti berikut:</p>
<pre><code class="language-html"><span class="hljs-doctype">&lt;!DOCTYPE html&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">head</span>&gt;</span>
 ... skip ...
  <span class="hljs-comment">&lt;!-- include source files here... --&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">script</span> <span class="hljs-attribute">src</span>=<span class="hljs-value">"src/fizz_buzz.js"</span>&gt;</span><span class="javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-title">script</span>&gt;</span>

  <span class="hljs-comment">&lt;!-- include spec files here... --&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">script</span> <span class="hljs-attribute">src</span>=<span class="hljs-value">"spec/fizz_buzz_spec.js"</span>&gt;</span><span class="javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-title">script</span>&gt;</span>

<span class="hljs-tag">&lt;/<span class="hljs-title">head</span>&gt;</span>
... skip ...
</code></pre>
<p>Di situ bagian source files diubah menjadi <code>src/fizz_buzz.js</code> yang merupakan implementasi fizzBuzz kita, dan spec files menjadi <code>spec/fizz_buzz_spec.js</code> yang merupakan kode specnya. Kemudian, file <code>SpecRunner.html</code> tersebut dibuka dengan browser, hasilnya adalah tampilan "No specs found", karena memang spec belum ditulis.</p>
<p>Kita bisa mulai menulis test/spec yang diperlukan. Kondisi pertama yang paling mudah adalah jika <code>n</code> tidak habis dibagi 3 maupun 5, makan akan mengembalikan string nilai <code>n</code> itu sendiri. Artinya, jika dipanggil <code>fizzBuzz(1)</code> akan dihasilkan <code>"1"</code>. Spesifikasi ditulis seperti berikut dalam file <code>spec/fizz_buzz_spec.js</code> :</p>
<pre><code class="language-javascript">describe(<span class="hljs-string">'fizzBuzz'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
  describe(<span class="hljs-string">'jika n adalah 1'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
    it(<span class="hljs-string">'seharusnya menghasilkan "1"'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
      expect(fizzBuzz(<span class="hljs-number">1</span>)).toEqual(<span class="hljs-string">"1"</span>);
    });
  });
});
</code></pre>
<p>Jika file <code>SpecRunner.html</code> dimuat ulang di browser, akan tampil galat</p>
<pre><code>fizzBuzz jika n adalah 1 seharusnya menghasilkan "1"
ReferenceError: fizzBuzz is not defined in file:///lokasi/file/jasmine/spec/fizz_buzz_spec.js (line 4)

...dst...
</code></pre>
<p>Tentu saja, karena kita belum mengimplementasikan fungsi fizzBuzz, bahkan filenya pun belum ada. Munculnya galat ini adalah bagian penting dan akan berdosa jika kita tidak melihat atau mengeceknya. Galat ini akan menjadi bukti bahwa test framework dapat bekerja dan test yang kita tulis juga berjalan. Inilah tahap Red dalam siklus "Red/Green/Refactor".</p>
<p>Kode untuk meluluskan test tersebut, ditulis di dalam file <code>src/fizz_buzz.js</code>:</p>
<pre><code class="language-javascript"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">fizzBuzz</span><span class="hljs-params">()</span> </span>{
  <span class="hljs-keyword">return</span> <span class="hljs-string">"1"</span>;
}
</code></pre>
<p>Ketika file <code>SpecRunner</code> dimuat ulang, kita akan mendapati pesan berwarna hijau:</p>
<pre><code>1 spec, 0 failures

    fizzBuzz
        jika n adalah 1
            seharusnya menghasilkan "1"
</code></pre>
<p>Nah kita berhasil lulus ujian pertama dengan kode yang sangat sederhana. Inilah "Green". Karena masih sederhana, kode tersebut belum perlu direfaktor. Kita bisa maju ke ujian selanjutnya. Bilangan 2 juga tidak habis dibagi 3 maupun 5, sehingga diharapkan pemanggilan <code>fizzBuzz(2)</code> akan menghasilkan <code>"2"</code>. Spec ditambahkan menjadi seperti berikut:</p>
<pre><code class="language-javascript">describe(<span class="hljs-string">'fizzBuzz'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
  describe(<span class="hljs-string">'jika n adalah 1'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
    it(<span class="hljs-string">'seharusnya menghasilkan "1"'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
      expect(fizzBuzz(<span class="hljs-number">1</span>)).toEqual(<span class="hljs-string">"1"</span>);
    });
  });

  describe(<span class="hljs-string">'jika n adalah 2'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
    it(<span class="hljs-string">'seharusnya menghasilkan "2"'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
      expect(fizzBuzz(<span class="hljs-number">2</span>)).toEqual(<span class="hljs-string">"2"</span>);
    });
  });
});
</code></pre>
<p>Jika dimuat ulang, <code>SpecRunner</code> akan menampilkan pesan merah</p>
<pre><code>2 specs, 1 failure
Spec List | Failures
fizzBuzz jika n adalah 2 seharusnya menghasilkan "2"
Expected '1' to equal '2'.
</code></pre>
<p>Menunjukkan bahwa implementasi kita belum lulus untuk kasus ke dua. Kode implementasi diperbaiki menjadi seperti berikut:</p>
<pre><code class="language-javascript"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">fizzBuzz</span><span class="hljs-params">(n)</span> </span>{
  <span class="hljs-keyword">return</span> n.toString();
}
</code></pre>
<p>fungsi fizzBuzz sudah dapat menerima parameter <code>n</code>, dan mengembalikan nilai <code>n.toString()</code>.</p>
<p>Muat ulang lagi <code>SpecRunner</code>, akan didapati pesan hijau:</p>
<pre><code>2 specs, 0 failures

    fizzBuzz
        jika n adalah 1
            seharusnya menghasilkan "1"
        jika n adalah 2
            seharusnya menghasilkan "2"
</code></pre>
<p>Implementasi kita sudah lulus untuk kedua kasus. Kode masih cukup sederhana dan belum perlu refaktor. Kita memasuki kasus berikutnya, yaitu angka 3 yang merupakan angka yang habis dibagi 3, sehingga seharusnya <code>fizzBuzz(3)</code> menghasilkan nilai <code>"Fizz"</code>. Spec ditambahkan seperti berikut:</p>
<pre><code class="language-javascript">describe(<span class="hljs-string">'fizzBuzz'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
  describe(<span class="hljs-string">'jika n adalah 1'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
    it(<span class="hljs-string">'seharusnya menghasilkan "1"'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
      expect(fizzBuzz(<span class="hljs-number">1</span>)).toEqual(<span class="hljs-string">"1"</span>);
    });
  });

  describe(<span class="hljs-string">'jika n adalah 2'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
    it(<span class="hljs-string">'seharusnya menghasilkan "2"'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
      expect(fizzBuzz(<span class="hljs-number">2</span>)).toEqual(<span class="hljs-string">"2"</span>);
    });
  });

  describe(<span class="hljs-string">'jika n adalah 3'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
    it(<span class="hljs-string">'seharusnya menghasilkan "Fizz"'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
      expect(fizzBuzz(<span class="hljs-number">3</span>)).toEqual(<span class="hljs-string">"Fizz"</span>);
    });
  });
});
</code></pre>
<p><code>SpecRunner</code> akan menampilkan pesan merah jika dimuat ulang:</p>
<pre><code>3 specs, 1 failure
Spec List | Failures
fizzBuzz jika n adalah 3 seharusnya menghasilkan "3"
Expected '3' to equal 'Fizz'.
</code></pre>
<p>Lagi-lagi, implementasi perlu diperbaiki. Kita mulai perlu menggunakan logika/kondisional di sini.</p>
<pre><code class="language-javascript"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">fizzBuzz</span><span class="hljs-params">(n)</span> </span>{
  <span class="hljs-keyword">if</span>(n == <span class="hljs-number">3</span>) <span class="hljs-keyword">return</span> <span class="hljs-string">"Fizz"</span>;
  <span class="hljs-keyword">return</span> n.toString();
}
</code></pre>
<p>Jalankan <code>SpecRunner</code> lagi, akan didapati pesan hijau yang membuktikan kebenaran implementasi kita:</p>
<pre><code>3 specs, 0 failures

    fizzBuzz
        jika n adalah 1
            seharusnya menghasilkan "1"
        jika n adalah 2
            seharusnya menghasilkan "2"
        jika n adalah 3
            seharusnya menghasilkan "Fizz"
</code></pre>
<p>Dilanjutkan lagi, bilangan lain yang habis dibagi 3 adalah 6, diharapkan pemanggilan <code>fizzBuzz(6)</code> akan menghasilkan <code>"Fizz"</code> juga, Spec kita tambah:</p>
<pre><code class="language-javascript">describe(<span class="hljs-string">'fizzBuzz'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
  describe(<span class="hljs-string">'jika n adalah 1'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
    it(<span class="hljs-string">'seharusnya menghasilkan "1"'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
      expect(fizzBuzz(<span class="hljs-number">1</span>)).toEqual(<span class="hljs-string">"1"</span>);
    });
  });

  describe(<span class="hljs-string">'jika n adalah 2'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
    it(<span class="hljs-string">'seharusnya menghasilkan "2"'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
      expect(fizzBuzz(<span class="hljs-number">2</span>)).toEqual(<span class="hljs-string">"2"</span>);
    });
  });

  describe(<span class="hljs-string">'jika n adalah 3'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
    it(<span class="hljs-string">'seharusnya menghasilkan "Fizz"'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
      expect(fizzBuzz(<span class="hljs-number">3</span>)).toEqual(<span class="hljs-string">"Fizz"</span>);
    });
  });

  describe(<span class="hljs-string">'jika n adalah 6'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
    it(<span class="hljs-string">'seharusnya menghasilkan "Fizz"'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
      expect(fizzBuzz(<span class="hljs-number">6</span>)).toEqual(<span class="hljs-string">"Fizz"</span>);
    });
  });
});
</code></pre>
<p>Seperti yang sudah diduga, SpecRunner pasti akan menunjukkan gagalnya test kita ketika dimuat ulang:</p>
<pre><code>4 specs, 1 failure
Spec List | Failures
fizzBuzz jika n adalah 6 seharusnya menghasilkan "Fizz"
Expected '6' to equal 'Fizz'.
</code></pre>
<p>Implementasi diperbaiki kembali, karena 6 dan juga 3 habis dibagi 3, keduanya bisa menghasilkan "Fizz" dengan cara yang sama, yaitu dengan menguji apakah angka input habis dibagi 3 (<em>yeah, obviously</em>):</p>
<pre><code class="language-javascript"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">fizzBuzz</span><span class="hljs-params">(n)</span> </span>{
  <span class="hljs-keyword">if</span>(n % <span class="hljs-number">3</span> == <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> <span class="hljs-string">"Fizz"</span>;
  <span class="hljs-keyword">return</span> n.toString();
}
</code></pre>
<p>Seperti harapan, implementasi ini akan lulus:</p>
<pre><code>4 specs, 0 failures

    fizzBuzz
        jika n adalah 1
            seharusnya menghasilkan "1"
        jika n adalah 2
            seharusnya menghasilkan "2"
        jika n adalah 3
            seharusnya menghasilkan "Fizz"
        jika n adalah 6
            seharusnya menghasilkan "Fizz"
</code></pre>
<p>Kita maju ke tahap berikutnya, yaitu jika n adalah 5, bilangan terkecil yang habis dibagi 5, seharusnya menghasilkan <code>"Buzz"</code>:</p>
<p><em>(spec lengkap tidak dicantumkan untuk menghemat tempat)</em></p>
<pre><code class="language-javascript">describe(<span class="hljs-string">'jika n adalah 5'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
  it(<span class="hljs-string">'seharusnya menghasilkan "Buzz"'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
    expect(fizzBuzz(<span class="hljs-number">5</span>)).toEqual(<span class="hljs-string">"Buzz"</span>);
  });
});
</code></pre>
<p>Seperti sebelumnya, <code>SpecRunner</code> akan menampilkan gagal nya test tersebut:</p>
<pre><code>5 specs, 1 failure
Spec List | Failures
fizzBuzz jika n adalah 5 seharusnya menghasilkan "Buzz"
Expected '5' to equal 'Buzz'.
</code></pre>
<p>Mari kita perbaiki implementasi fizzBuzz sehingga sesuai harapan:</p>
<pre><code class="language-javascript"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">fizzBuzz</span><span class="hljs-params">(n)</span> </span>{
  <span class="hljs-keyword">if</span>(n % <span class="hljs-number">3</span> == <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> <span class="hljs-string">"Fizz"</span>;
  <span class="hljs-keyword">if</span>(n == <span class="hljs-number">5</span>) <span class="hljs-keyword">return</span> <span class="hljs-string">"Buzz"</span>;
  <span class="hljs-keyword">return</span> n.toString();
}
</code></pre>
<p>Muat ulang SpecRunner, implementasi kita kembali ke dalam kondisi hijau dan lulus semua test.</p>
<pre><code>5 specs, 0 failures

    fizzBuzz
        jika n adalah 1
            seharusnya menghasilkan "1"
        jika n adalah 2
            seharusnya menghasilkan "2"
        jika n adalah 3
            seharusnya menghasilkan "Fizz"
        jika n adalah 6
            seharusnya menghasilkan "Fizz"
        jika n adalah 5
            seharusnya menghasilkan "Buzz"
</code></pre>
<p>Jika diperhatikan kembali implementasi kita, disana terdapat 3 kali statement <code>return</code>. Kita bisa memperbaikinya dengan menyimpan nilai hasil sementara, kemudian baru memanggil statemen <code>return</code> di akhir saja. Kode implementasi direfaktor seperti berikut:</p>
<pre><code class="language-javascript"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">fizzBuzz</span><span class="hljs-params">(n)</span> </span>{
  <span class="hljs-keyword">var</span> returnValue = n.toString();

  <span class="hljs-keyword">if</span>(n % <span class="hljs-number">3</span> == <span class="hljs-number">0</span>) returnValue =  <span class="hljs-string">"Fizz"</span>;
  <span class="hljs-keyword">if</span>(n == <span class="hljs-number">5</span>) returnValue =  <span class="hljs-string">"Buzz"</span>;

  <span class="hljs-keyword">return</span> returnValue;
}
</code></pre>
<p>Kita baru saja menjalani tahap "Refactor" dalam siklus "Red/Green/Refactor". Jika dimuat ulang lagi SpecRunner, seharusnya kita masih mendapati pesan hijau yang sama. Inilah salah satu keuntungan dari Test Driven Development, kemudahan dan perasaan aman dalam melakukan refaktor. <em>Yeah</em>.</p>
<p>Bilangan berikutnya yang habis dibagi 5 adalah 10, <code>fizzBuzz(10)</code> akan menghasilkan <code>"Buzz"</code> juga.</p>
<pre><code class="language-javascript">describe(<span class="hljs-string">'jika n adalah 10'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
  it(<span class="hljs-string">'seharusnya menghasilkan "Buzz"'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
    expect(fizzBuzz(<span class="hljs-number">10</span>)).toEqual(<span class="hljs-string">"Buzz"</span>);
  });
});
</code></pre>
<p>Lagi dan lagi, kita mendapati pesan merah saat memuat ulang SpecRunner:</p>
<pre><code>6 specs, 1 failure
Spec List | Failures
fizzBuzz jika n adalah 10 seharusnya menghasilkan "Buzz"
Expected '10' to equal 'Buzz'.
</code></pre>
<p>Seperti sebelumnya, 5 dan 10 sama-sama habis dibagi 5, untuk meluluskan test tersebut, kita mulai perlu mengecek apakah <code>n</code> habis dibagi 5. Implementasi kita perbaiki kembali:</p>
<pre><code class="language-javascript"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">fizzBuzz</span><span class="hljs-params">(n)</span> </span>{
  <span class="hljs-keyword">var</span> returnValue = n.toString();

  <span class="hljs-keyword">if</span>(n % <span class="hljs-number">3</span> == <span class="hljs-number">0</span>) returnValue =  <span class="hljs-string">"Fizz"</span>;
  <span class="hljs-keyword">if</span>(n % <span class="hljs-number">5</span> == <span class="hljs-number">0</span>) returnValue =  <span class="hljs-string">"Buzz"</span>;

  <span class="hljs-keyword">return</span> returnValue;
}
</code></pre>
<p>Sesuai harapan, implementasi kita sudah lulus untuk kasus <code>n</code> =  1,2,3,6,5, dan 10.</p>
<pre><code>6 specs, 0 failures

    fizzBuzz
        jika n adalah 1
            seharusnya menghasilkan "1"
        jika n adalah 2
            seharusnya menghasilkan "2"
        jika n adalah 3
            seharusnya menghasilkan "Fizz"
        jika n adalah 6
            seharusnya menghasilkan "Fizz"
        jika n adalah 5
            seharusnya menghasilkan "Buzz"
        jika n adalah 10
            seharusnya menghasilkan "Buzz"
</code></pre>
<hr>
<p>Mari istiahat sejenak dari iterasi sambil berbincang. Di atas, saya tidak bosan mengulang-ulang penampilan SpecRunner setiap kali selesai menulis spec maupun implementasi. Implementasinya pun sangat naif dan berputar-putar. Saya harap anda pun tidak bosan, atau setidaknya bisa menahan bosan.</p>
<p>Membuat test yang sederhana, melihat test tersebut gagal, kemudian menulis implementasi yang sangat naif untuk meluluskan test tersebut adalah langkah yang sangat penting. Dalam perjalanan, ketika menulis software yang lebih besar dan rumit, sering kali kita akan tergoda untuk melewatkan test yang sangat sederhana, atau menulis test kemudian langsung membuat implementasinya tanpa melihat test yang gagal. Kadang hal ini tidak apa-apa, malah lebih cepat selesai. Tetapi sering kali bug dalam software muncul karena proses penulisan test yang tidak hati-hati. Test yang bertele-tele dan sederhana akan membantu kita dalam memikirkan berbagai kondisi yang terjadi pada kode sehingga bisa menghindari bug.</p>
<p>Tulisan ini ditujukan untuk pemula dalam Test Driven Development. Bisa dibilang proses yang diulang-ulang ini merupakan indoktrinasi dogma TDD, agar programmer menjadi terbiasa dengan siklus "Red/Green/Refactor". Pada akhirnya ketika software selesai diimplementasikan secara lengkap, test/spec yang bertele-tele bisa direfactor juga supaya lebih lugas.</p>
<hr>
<p>Kita lanjutkan kembali perjalanan menuju fizzBuzz. Kondisi berikutnya, yaitu jika <code>n</code> habis dibagi 3 dan 5. Bilangan terkecil yang habis dibagi 3 dan 5 adalah 15, jadi kita harapkan <code>fizzBuzz(15)</code> akan menghasilkan <code>"FizzBuzz"</code>. Spec ditambahkan:</p>
<pre><code class="language-javascript">describe(<span class="hljs-string">'jika n adalah 15'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
  it(<span class="hljs-string">'seharusnya menghasilkan "FizzBuzz"'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
    expect(fizzBuzz(<span class="hljs-number">15</span>)).toEqual(<span class="hljs-string">"FizzBuzz"</span>);
  });
});
</code></pre>
<p>Lagi dan lagi, SpecRunner akan menampilkan pesan merah jika dimuat ulang:</p>
<pre><code>7 specs, 1 failure
Spec List | Failures
fizzBuzz jika n adalah 15 seharusnya menghasilkan "FizzBuzz"
Expected 'Buzz' to equal 'FizzBuzz'.
</code></pre>
<p>Kembali kita perbaiki implementasi fizzBuzz:</p>
<pre><code class="language-javascript"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">fizzBuzz</span><span class="hljs-params">(n)</span> </span>{
  <span class="hljs-keyword">var</span> returnValue = n.toString();

  <span class="hljs-keyword">if</span>(n % <span class="hljs-number">3</span> == <span class="hljs-number">0</span>) returnValue =  <span class="hljs-string">"Fizz"</span>;
  <span class="hljs-keyword">if</span>(n % <span class="hljs-number">5</span> == <span class="hljs-number">0</span>) returnValue =  <span class="hljs-string">"Buzz"</span>;
  <span class="hljs-keyword">if</span>(n == <span class="hljs-number">15</span>) returnValue = <span class="hljs-string">"FizzBuzz"</span>;

  <span class="hljs-keyword">return</span> returnValue;
}
</code></pre>
<p>Muat ulang lagi SpecRunner, tampaklah bahwa implementasi kita sudah bisa menghasilkan FizzBuzz juga inputnya 15</p>
<pre><code>7 specs, 0 failures

    fizzBuzz
        jika n adalah 1
            seharusnya menghasilkan "1"
        jika n adalah 2
            seharusnya menghasilkan "2"
        jika n adalah 3
            seharusnya menghasilkan "Fizz"
        jika n adalah 6
            seharusnya menghasilkan "Fizz"
        jika n adalah 5
            seharusnya menghasilkan "Buzz"
        jika n adalah 10
            seharusnya menghasilkan "Buzz"
        jika n adalah 15
            seharusnya menghasilkan "FizzBuzz"
</code></pre>
<p>Kita lanjutkan kembali, bilangan yang habis dibagi 3 dan 5 setelah 15 adalah 30.</p>
<pre><code class="language-javascript">describe(<span class="hljs-string">'jika n adalah 30'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
  it(<span class="hljs-string">'seharusnya menghasilkan "FizzBuzz"'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
    expect(fizzBuzz(<span class="hljs-number">30</span>)).toEqual(<span class="hljs-string">"FizzBuzz"</span>);
  });
});
</code></pre>
<p>Kembali kita menghadapi galat merah yang menunjukkan gagalnya test:</p>
<pre><code>8 specs, 1 failure
Spec List | Failures
fizzBuzz jika n adalah 30 seharusnya menghasilkan "FizzBuzz"
Expected 'Buzz' to equal 'FizzBuzz'.
</code></pre>
<p>Tampak bahwa 30 masih dianggap sebagai bilangan yang habis dibagi 5, tanpa dicek apakah juga habis dibagi 3 sehingga hasilnya <code>"Buzz"</code>, bukan <code>"FizzBuzz"</code>. Untuk memenuhi spesifikasi, kita tambahkan pengecekan bilangan input. Bilangan yang habis dibagi 3 dan 5 pastinya habis dibagi 15, sehingga bisa kita perbaiki kembali implementasi kita seperti  berikut:</p>
<pre><code class="language-javascript"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">fizzBuzz</span><span class="hljs-params">(n)</span> </span>{
  <span class="hljs-keyword">var</span> returnValue = n.toString();

  <span class="hljs-keyword">if</span>(n % <span class="hljs-number">3</span> == <span class="hljs-number">0</span>) returnValue =  <span class="hljs-string">"Fizz"</span>;
  <span class="hljs-keyword">if</span>(n % <span class="hljs-number">5</span> == <span class="hljs-number">0</span>) returnValue =  <span class="hljs-string">"Buzz"</span>;
  <span class="hljs-keyword">if</span>(n % <span class="hljs-number">15</span> == <span class="hljs-number">0</span>) returnValue =  <span class="hljs-string">"FizzBuzz"</span>;

  <span class="hljs-keyword">return</span> returnValue;
}
</code></pre>
<p>SpecRunner dimuat ulang, tampaklah implementasi kita berhasil lulus:</p>
<pre><code>8 specs, 0 failures

    fizzBuzz
        jika n adalah 1
            seharusnya menghasilkan "1"
        jika n adalah 2
            seharusnya menghasilkan "2"
        jika n adalah 3
            seharusnya menghasilkan "Fizz"
        jika n adalah 6
            seharusnya menghasilkan "Fizz"
        jika n adalah 5
            seharusnya menghasilkan "Buzz"
        jika n adalah 10
            seharusnya menghasilkan "Buzz"
        jika n adalah 15
            seharusnya menghasilkan "FizzBuzz"
        jika n adalah 30
            seharusnya menghasilkan "FizzBuzz"
</code></pre>
<p>Sejauh ini, implementasi fizzBuzz kita sudah memenuhi syarat yang diminta dari spesifikasi awal. Jika dilihat kode implementasi, menurut saya sudah cukup sederhana dan rapi sehingga tidak perlu lagi direfactor. Jika menurut anda masih perlu refactor, silakan dicoba. Sudah ada tes, jadi bisa dengan tenang mencoba-coba refaktornya. <em>Ntap</em>.</p>
<p>Kode test yang kita buat diatas selengkapnya adalah seperti berikut:</p>
<pre><code class="language-javascript">describe(<span class="hljs-string">'fizzBuzz'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
  describe(<span class="hljs-string">'jika n adalah 1'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
    it(<span class="hljs-string">'seharusnya menghasilkan "1"'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
      expect(fizzBuzz(<span class="hljs-number">1</span>)).toEqual(<span class="hljs-string">"1"</span>);
    });
  });

  describe(<span class="hljs-string">'jika n adalah 2'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
    it(<span class="hljs-string">'seharusnya menghasilkan "2"'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
      expect(fizzBuzz(<span class="hljs-number">2</span>)).toEqual(<span class="hljs-string">"2"</span>);
    });
  });

  describe(<span class="hljs-string">'jika n adalah 3'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
    it(<span class="hljs-string">'seharusnya menghasilkan "Fizz"'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
      expect(fizzBuzz(<span class="hljs-number">3</span>)).toEqual(<span class="hljs-string">"Fizz"</span>);
    });
  });

  describe(<span class="hljs-string">'jika n adalah 6'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
    it(<span class="hljs-string">'seharusnya menghasilkan "Fizz"'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
      expect(fizzBuzz(<span class="hljs-number">6</span>)).toEqual(<span class="hljs-string">"Fizz"</span>);
    });
  });

  describe(<span class="hljs-string">'jika n adalah 5'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
    it(<span class="hljs-string">'seharusnya menghasilkan "Buzz"'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
      expect(fizzBuzz(<span class="hljs-number">5</span>)).toEqual(<span class="hljs-string">"Buzz"</span>);
    });
  });

  describe(<span class="hljs-string">'jika n adalah 10'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
    it(<span class="hljs-string">'seharusnya menghasilkan "Buzz"'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
      expect(fizzBuzz(<span class="hljs-number">10</span>)).toEqual(<span class="hljs-string">"Buzz"</span>);
    });
  });

  describe(<span class="hljs-string">'jika n adalah 15'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
    it(<span class="hljs-string">'seharusnya menghasilkan "FizzBuzz"'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
      expect(fizzBuzz(<span class="hljs-number">15</span>)).toEqual(<span class="hljs-string">"FizzBuzz"</span>);
    });
  });

  describe(<span class="hljs-string">'jika n adalah 30'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
    it(<span class="hljs-string">'seharusnya menghasilkan "FizzBuzz"'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
      expect(fizzBuzz(<span class="hljs-number">30</span>)).toEqual(<span class="hljs-string">"FizzBuzz"</span>);
    });
  });
});
</code></pre>
<p>Jika disimak, dalam test tersebut terdapat pengujian yang sebenarnya mirip kondisinya, yaitu ketika n=1 dan 2, n=3 dan 6, n=5 dan 10, serta n=15 dan 30. Kondisi-kondisi tersebut dapat dikelompokkan sehingga test menjadi lugas dan lebih jelas lagi dalam menunjukkan tujuan daripada kode implementasi kita. Saya merefaktor test menjadi seperti berikut:</p>
<pre><code class="language-javascript">describe(<span class="hljs-string">'fizzBuzz'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
  describe(<span class="hljs-string">'jika n adalah tidak habis dibagi 3 maupun 5'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
    it(<span class="hljs-string">'seharusnya menghasilkan string bilangan itu sendiri'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
      expect(fizzBuzz(<span class="hljs-number">1</span>)).toEqual(<span class="hljs-string">"1"</span>);
      expect(fizzBuzz(<span class="hljs-number">2</span>)).toEqual(<span class="hljs-string">"2"</span>);
    });
  });

  describe(<span class="hljs-string">'jika n habis dibagi 3'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
    it(<span class="hljs-string">'seharusnya menghasilkan "Fizz"'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
      expect(fizzBuzz(<span class="hljs-number">3</span>)).toEqual(<span class="hljs-string">"Fizz"</span>);
      expect(fizzBuzz(<span class="hljs-number">6</span>)).toEqual(<span class="hljs-string">"Fizz"</span>);
    });
  });

  describe(<span class="hljs-string">'jika habis dibagi 5'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
    it(<span class="hljs-string">'seharusnya menghasilkan "Buzz"'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
      expect(fizzBuzz(<span class="hljs-number">5</span>)).toEqual(<span class="hljs-string">"Buzz"</span>);
      expect(fizzBuzz(<span class="hljs-number">10</span>)).toEqual(<span class="hljs-string">"Buzz"</span>);
    });
  });

  describe(<span class="hljs-string">'jika n habis dibagi 15'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
    it(<span class="hljs-string">'seharusnya menghasilkan "FizzBuzz"'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
      expect(fizzBuzz(<span class="hljs-number">15</span>)).toEqual(<span class="hljs-string">"FizzBuzz"</span>);
      expect(fizzBuzz(<span class="hljs-number">30</span>)).toEqual(<span class="hljs-string">"FizzBuzz"</span>);
    });
  });
});
</code></pre>
<p>Kode implementasi kita masih lulus dengan test setelah refaktor:</p>
<pre><code>4 specs, 0 failures

    fizzBuzz
        jika n adalah tidak habis dibagi 3 maupun 5
            seharusnya menghasilkan string bilangan itu sendiri
        jika n habis dibagi 3
            seharusnya menghasilkan "Fizz"
        jika habis dibagi 5
            seharusnya menghasilkan "Buzz"
        jika n habis dibagi 15
            seharusnya menghasilkan "FizzBuzz"
</code></pre>
<p>Tampak bahwa hasil jalannya SpecRunner jadi sangat mirip dengan spesifikasi masalah yang diminta sejak awal. Anda bisa menambahkan lagi testcase untuk bilangan lain di tiap-tiap kondisi. Hasilnya tetap sama.</p>
<p>Sampai disini lengkaplah fungsi fizzBuzz dalam javascript dengan test menggunakan Jasmine Spec. Ke depan saya akan menulis tentang penggunaan Jasmine Spec yang lebih berhubungan dengan habitat asli javascript, yaitu halaman web. Setelah itu, rencananya saya tidak akan banyak menyinggung dasar Test Driven Development dan lebih sering menulis secara singkat temuan dan trik saat menggunakan JasmineSpec, ataupun test framework lainnya.</p>

